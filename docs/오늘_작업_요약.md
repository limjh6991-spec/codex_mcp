# 오늘 작업 요약

## 2025-10-11 현황

### 주요 진척
- USD(Re)생성 및 `hand_tcp` 프림 검증, Isaac Sim Stage 검색 가이드 정리
- Isaac Sim 기본 확장 비활성화를 위한 `manage_isaacsim_extensions.py` 스크립트 신규 작성 및 다수 확장 적용
- Sim2Real 강화학습 준비 현황 파악 후 USD 선행 학습 → 실측 캘리브레이션 → 피드백 루프 중심 로드맵 수립

### 내일(또는 다음 세션) 목표
1. `verify_usd_roarm_m3.py` 인자 처리 수정 및 Stage 출력 기능 복원
2. Isaac Sim 실행 스크립트(`launch_isaacsim_gui.sh` 등)에서 확장 `--disable/--enableOnly` 옵션 실험으로 재활성화 문제 추가 확인
3. `isaac_roarm_env.py` 환경 구현 점검 및 `training/train_ppo.py`에 실제 Isaac 환경 연결 옵션 추가
4. Domain randomization / reward config 세부값(마찰, 센서 지연 등) 현실 측정치를 반영할 초안 마련

---

## 기존 기록 (참고)

### 1. 안정화 및 복구
- 손상된 `ipc_policy_gateway.py` 글로벌 상태 (스키마 validator, 카운터, 정책 컨테이너 등) 복구
- NameError(_validate)로 인한 게이트웨이 기동 실패 해결
- 메트릭 스냅샷 로직 단일화(`_flush_metrics`) 및 모든 카운터 일관 포함
- admin 명령(`flush_metrics`, `get_counters`) 추가로 테스트 결정성 확보
- `--log-dir` 옵션 도입하여 프로세스 간 로그/메트릭 충돌 제거

### 2. Deadline / Escalation 개선
- 연속 deadline miss 기반 escalation 이벤트(`deadline_escalation`) 구현 및 테스트 통과
- Escalation 시 degrade mode 활성화 + 확률적 delta zeroing (`--degrade-mode-ratio`)
- 초소형 deadline(≤1ms) 환경에서 deterministic miss 유도를 위한 단일 oversleep 분기 통합
- Escalation advisory 이벤트에 `last_latency_ms`, `deadline_ms` 메타 추가

### 3. 안전/품질 기능 확장
- Joint limit clipping 및 joint spec mismatch 감시 (advisory + configurable cooldown: `--joint-spec-mismatch-cooldown`)
- rand_hash mismatch ring buffer 및 로그 유지 (중복 로깅 블록 제거)

### 4. 관측/카운터 확장
- 새로운 카운터: `degrade_zeroed` (degrade 모드로 zero 처리된 횟수)
- 기존: deadline_miss, consec_deadline_miss, deadline_escalation_events, joint_limit_violation, joint_spec_mismatch, rand_hash_mismatch 유지

### 5. 테스트 상태
- 부분 테스트: `tests/test_deadline_escalation.py` 통과 (1 passed)
- 전체 테스트: 25 passed / 5 skipped
- 안정화 후 회귀 없음 확인

### 6. 코드 청소/리팩터링
- 중복된 rand_hash mismatch 처리 제거
- micro-sleep vs oversleep 이원화된 로직 → 단일 overshoot 로직으로 단순화

### 7. 남은/추천 후속 작업 (과거 기록)
1. degrade zeroing 전용 테스트 (ratio=1.0 환경의 누적 카운터 검증)
2. escalation advisory에 `consec_before_reset` 필드 추가 (분석 편의)
3. Prometheus 지표 파생: zeroing 비율(`degrade_zeroed / deadline_miss` 등) 계산 여부
4. 정책 미로딩 상태 fast-path deadline pre-check 정교화
5. 성능 기준치 업데이트 및 변경 영향 측정

### 8. 빠른 재현 시나리오
```bash
python scripts/ipc_policy_gateway.py --port 45123 --deadline-ms 1.0 --deadline-escalate-threshold 3 --degrade-mode-ratio 0.5 --log-dir /tmp/gw_demo
```
이후 여러 obs 전송 → escalation + degrade_zeroed 증가 관측.

---
(문서 자동 생성)
